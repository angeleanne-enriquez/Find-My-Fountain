{{!-- 
  profile.handlebars
  User profile page for Find My Fountain.
  Shows basic user info, favorites, and reviews.
  If the logged-in user is viewing their own profile,
  a simple settings/edit section is also displayed.
--}}

<section class="page-container card">
  {{!-- Basic profile info --}}
  <header>
    <h1>{{viewUser.username}}'s Profile</h1>

    {{#if picture}}
      <img
        src="{{viewUser.picture}}"
        alt="{{viewUser.username}}'s profile picture"
        class="profile-picture"
      />
    {{/if}}

    <p><strong>Name:</strong> {{viewUser.firstName}} {{viewUser.lastName}}</p>

    {{#if viewUser.bio}}
      <p><strong>Bio:</strong> {{viewUser.bio}}</p>
    {{else}}
      <p><strong>Bio:</strong> This user has not added a bio yet.</p>
    {{/if}}
  </header>

  <hr />

  {{!-- Favorite fountains --}}
  <section>
    <h2>Favorite Fountains</h2>

    {{#if viewUser.favorites}}
      {{#if viewUser.favorites.length}}
        <ul>
          {{#each viewUser.favorites}}
            <li>
              <a href="/fountain/{{this._id}}">{{this.park}}, {{this.borough}}</a>
              {{#if ../isOwnProfile}}
                <form action="/fountain/{{this._id}}/dislike" method="POST">
                  <button type="submit">Unfavorite</button>
                </form>
              {{/if}}
            </li>
          {{/each}}
        </ul>
      {{else}}
        <p>This user has no favorite fountains yet.</p>
      {{/if}}
    {{else}}
      <p>This user has no favorite fountains yet.</p>
    {{/if}}
  </section>

  <hr />

  {{!-- Reviews --}}
  <section>
    <h2>Reviews</h2>

    {{#if viewUser.reviews}}
      {{#if viewUser.reviews.length}}
        <ul>
          {{#each viewUser.reviews}}
            <li>
              <p>
                <strong>Fountain:</strong>
                <a href="/fountain/{{this.fountainId}}">{{this.fountainName}}</a>
              </p>
              <p><strong>Rating:</strong> {{this.rating}} / 5</p>
              <p>{{this.text}}</p>

              {{!-- Only show edit/delete if this review is editable by the current user --}}
              {{#if this.canEdit}}
                <form action="/reviews/{{this.id}}/edit" method="GET" style="display:inline;">
                  <button type="submit">Edit</button>
                </form>
                <form action="/reviews/{{this.id}}/delete" method="POST" style="display:inline;">
                  <button type="submit">Delete</button>
                </form>
              {{/if}}
            </li>
          {{/each}}
        </ul>
      {{else}}
        <p>This user has not written any reviews yet.</p>
      {{/if}}
    {{else}}
      <p>This user has not written any reviews yet.</p>
    {{/if}}
  </section>

  <hr />

  {{!-- Settings for your own profile --}}
  {{#if isOwnProfile}}
    <a href="/user/{{user.username}}/settings">Update your profile and settings</a>
    <a href="/logout">Log Out</a>
    <hr />
  {{/if}}

  <p>
    <a href="/">Back to Landing Page</a>
  </p>
</section>
