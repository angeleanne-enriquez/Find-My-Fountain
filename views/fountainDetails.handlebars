{{!--
  Shows information about a single fountain:
  location, average ratings, operational status, favorites,
  and user reviews. Logged-in users can write a review,
  mark the fountain as working, and like/dislike the fountain.
--}}

<section class="page-container card">
  <h1>Fountain Details</h1>

  {{!-- Basic fountain info --}}
  <p><strong>Borough:</strong> {{fountain.borough}}</p>
  <p>
    <strong>Location:</strong>
    {{fountain.park}}
  </p>

  <p><strong>Number of Favorites:</strong> {{fountain.numFavorites}}</p>

  {{!-- Average ratings (if available) --}}
  {{#if fountain.avgRatings}}
    <h2>Average Ratings</h2>
    <ul>
      <li><strong>Taste:</strong> {{fountain.avgRatings.taste}}</li>
      <li><strong>Location:</strong> {{fountain.avgRatings.location}}</li>
      <li><strong>Pressure:</strong> {{fountain.avgRatings.pressure}}</li>
      <li><strong>Cleanliness:</strong> {{fountain.avgRatings.cleanliness}}</li>
      <li><strong>Accessibility:</strong> {{fountain.avgRatings.accessibility}}</li>
      <li>
        <strong>Operational:</strong>
        {{#if fountain.avgRatings.operational}}
          Yes
        {{else}}
          No
        {{/if}}
      </li>
    </ul>
  {{/if}}

  {{!-- Like / Dislike fountain (only if logged in) --}}
  {{#if user}}
    <section>
      <h2>Do you like this fountain?</h2>

      {{#if favorited}}
        <form action="/fountain/{{fountain._id}}/dislike" method="POST">
          <button type="submit">Unfavorite</button>
        </form>
      {{else}}
        <form action="/fountain/{{fountain._id}}/like" method="POST">
          <button type="submit">Favorite</button>
        </form>
      {{/if}}

      {{#if likeError}}
        <p class="error">{{likeError}}</p>
      {{/if}}
    </section>
  {{/if}}

  <hr>

  {{!-- Reviews list --}}
  <section>
    <h2>Reviews</h2>

    {{#if reviews}}
      {{#if reviews.length}}
        <ul>
          {{#each reviews}}
            <li>
              <p>
                <a href="../user/{{this.username}}"><strong>Reviewer:</strong> {{this.username}}</a>
                {{#if this.date}}
                  - {{this.date}}
                {{/if}}
              </p>
              {{#if this.ratings}}
                <p><strong>Taste:</strong> {{this.ratings.taste}} / 5</p>
                <p><strong>Location:</strong> {{this.ratings.location}} / 5</p>
                <p><strong>Pressure:</strong> {{this.ratings.pressure}} / 5</p>
                <p><strong>Cleanliness:</strong> {{this.ratings.cleanliness}} / 5</p>
                <p><strong>Accessibility:</strong> {{this.ratings.accessibility}} / 5</p>
              {{/if}}
              <p>{{this.body}}</p>
            </li>
          {{/each}}
        </ul>
      {{else}}
        <p>No reviews yet. Be the first to review this fountain!</p>
      {{/if}}
    {{else}}
      <p>No reviews yet. Be the first to review this fountain!</p>
    {{/if}}
  </section>

  <hr>

  {{!-- Write a review + mark operational (only if logged in) --}}
  {{#if user}}
    <section>
      <h2>Write a Review</h2>

    {{!-- server-side error (from route) --}}
    {{#if reviewError}}
      <p class="error">{{reviewError}}</p>
    {{/if}}

    {{!-- client-side/Ajax error --}}
    <p id="review-error" class="error" hidden></p>

      <form action="/fountain/{{fountain._id}}" method="POST" id="review-form" name="review-form">
      {{!-- Taste rating --}}
        <div class="form-group">
          <label for="taste">Taste (1–5):</label>
          <select name="taste" id="taste">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        {{!-- Location rating --}}
        <div class="form-group">
          <label for="location">Location (1–5):</label>
          <select name="location" id="location">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        {{!-- Pressure rating --}}
        <div class="form-group">
          <label for="pressure">Pressure (1–5):</label>
          <select name="pressure" id="pressure">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        {{!-- Taste rating --}}
        <div class="form-group">
          <label for="cleanliness">Cleanliness (1–5):</label>
          <select name="cleanliness" id="cleanliness">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        {{!-- Accessibility rating --}}
        <div class="form-group">
          <label for="accessibility">Accessibility (1–5):</label>
          <select name="accessibility" id="accessibility">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        {{!-- Review text --}}
        <div class="form-group">
          <label for="reviewText">Your Review:</label>
          <textarea
            id="reviewText"
            name="reviewText"
            rows="4"
            cols="40"
            placeholder="Share your thoughts about this fountain..."
          ></textarea>
        </div>

        {{!-- Operational checkbox --}}
        <div class="form-group">
          <label for="operational">
            <input
              type="checkbox"
              id="operational"
              name="operational"
              value="true"
            >
            Mark this fountain as working
          </label>
        </div>

        <button type="submit">Submit Review</button>
      </form>
    </section>
  {{else}}
    <p>
      <a href="/login">Log in</a> or
      <a href="/register">create an account</a> to write a review,
      mark this fountain as working, and like/dislike this fountain.
    </p>
  {{/if}}

  <hr>

  <p>
    <a href="/">Back to Landing Page</a>
    <a href="/search">Back to Search Results</a>
  </p>
</section>
